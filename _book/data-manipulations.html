<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Data manipulations | A Minimal Book Example</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Data manipulations | A Minimal Book Example" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Data manipulations | A Minimal Book Example" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Yihui Xie" />


<meta name="date" content="2021-05-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-r-for-sna.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="literature.html"><a href="literature.html"><i class="fa fa-check"></i><b>3</b> Literature</a></li>
<li class="chapter" data-level="4" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>4</b> Methods</a></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a>
<ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="7" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html"><i class="fa fa-check"></i><b>7</b> Introduction to R for SNA</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html#preliminary-notes"><i class="fa fa-check"></i><b>7.1</b> Preliminary notes</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html#getting-up-and-running"><i class="fa fa-check"></i><b>7.2</b> Getting up and running</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html#working-with-rscript"><i class="fa fa-check"></i><b>7.3</b> Working with RScript</a></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html#installing-additional-packages"><i class="fa fa-check"></i><b>7.4</b> Installing additional packages</a></li>
<li class="chapter" data-level="7.5" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html#i-dont-understand-the-code"><i class="fa fa-check"></i><b>7.5</b> I don’t understand the code!!</a></li>
<li class="chapter" data-level="7.6" data-path="introduction-to-r-for-sna.html"><a href="introduction-to-r-for-sna.html#reading-in-data-files"><i class="fa fa-check"></i><b>7.6</b> Reading in data files</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-manipulations.html"><a href="data-manipulations.html"><i class="fa fa-check"></i><b>8</b> Data manipulations</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-manipulations.html"><a href="data-manipulations.html#define-missings"><i class="fa fa-check"></i><b>8.1</b> Define missings</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="data-manipulations.html"><a href="data-manipulations.html#r-base"><i class="fa fa-check"></i><b>8.1.1</b> R Base</a></li>
<li class="chapter" data-level="8.1.2" data-path="data-manipulations.html"><a href="data-manipulations.html#tidy"><i class="fa fa-check"></i><b>8.1.2</b> Tidy</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data-manipulations.html"><a href="data-manipulations.html#recoding-variables"><i class="fa fa-check"></i><b>8.2</b> Recoding variables</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="data-manipulations.html"><a href="data-manipulations.html#r-base-1"><i class="fa fa-check"></i><b>8.2.1</b> R Base</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-manipulations.html"><a href="data-manipulations.html#tidy-1"><i class="fa fa-check"></i><b>8.2.2</b> Tidy</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-manipulations.html"><a href="data-manipulations.html#means-and-counting-specific-values"><i class="fa fa-check"></i><b>8.3</b> Means and counting specific values</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-manipulations.html"><a href="data-manipulations.html#r-base-2"><i class="fa fa-check"></i><b>8.3.1</b> R Base</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-manipulations.html"><a href="data-manipulations.html#tidy-2"><i class="fa fa-check"></i><b>8.3.2</b> Tidy</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-manipulations.html"><a href="data-manipulations.html#merging-data-files"><i class="fa fa-check"></i><b>8.4</b> Merging data files</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-manipulations.html"><a href="data-manipulations.html#r-base-3"><i class="fa fa-check"></i><b>8.4.1</b> R Base</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-manipulations.html"><a href="data-manipulations.html#tidy-3"><i class="fa fa-check"></i><b>8.4.2</b> Tidy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Book Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulations" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Data manipulations</h1>
<p>Okay, lets start playing around with our dataset. We are going to have a look at specific variables, define missings, recode some values, etc. I will focus on the dataset created by the haven package.</p>
<div id="define-missings" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Define missings</h2>
<div id="r-base" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> R Base</h3>
<p>Lets use age as example. This variable is called <strong>lftop</strong> in CV. First have a look at this variable.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb64-1"><a href="data-manipulations.html#cb64-1"></a><span class="fu">str</span>(cv08_haven<span class="sc">$</span>lftop)</span>
<span id="cb64-2"><a href="data-manipulations.html#cb64-2"></a><span class="fu">summary</span>(cv08_haven<span class="sc">$</span>lftop)</span>
<span id="cb64-3"><a href="data-manipulations.html#cb64-3"></a><span class="fu">attr</span>(cv08_haven<span class="sc">$</span>lftop, <span class="st">&quot;labels&quot;</span>)</span>
<span id="cb64-4"><a href="data-manipulations.html#cb64-4"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>lftop, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>##  dbl+lbl [1:1963] 51, 39, 16, 29, 57, 49, 62, 34, 59, 41, 25, 43, 74, 17, 22, 32, 51, 66, 64, 2...
##  @ label        : chr &quot;Leeftijd OP op datum interview&quot;
##  @ format.spss  : chr &quot;F10.0&quot;
##  @ display_width: int 12
##  @ labels       : Named num [1:5] 0 1 2 99 125
##   ..- attr(*, &quot;names&quot;)= chr [1:5] &quot;&lt; één jaar&quot; &quot;één jaar&quot; &quot;twee jaar&quot; &quot;Onbekend&quot; ...
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   16.00   33.00   46.00   46.78   61.00   99.00 
## &lt; één jaar   één jaar  twee jaar   Onbekend   125 jaar 
##          0          1          2         99        125 
## 
##   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32   33   34   35 
##   40   37   39   30   30   25   25   38   26   22   18   23   29   30   22   28   23   23   24   38 
##   36   37   38   39   40   41   42   43   44   45   46   47   48   49   50   51   52   53   54   55 
##   35   37   34   48   45   34   36   39   43   38   41   32   41   45   29   29   43   32   25   27 
##   56   57   58   59   60   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75 
##   27   30   44   34   33   36   40   29   27   30   19   24   24   24   23   21   13   15   26   10 
##   76   77   78   79   80   81   82   83   84   85   86   87   88   89   90   91   99 &lt;NA&gt; 
##   14   17   13   13   10    7   10   10    7    6    3    8    2    3    1    3    4    0</code></pre>
<p>We have category ‘onbekend,’ which should be a missing. Let’s copy the original variable in a new one, and attach it to the dataset. Thus not:<br />
<code>lftop_new &lt;-  cv08$lftop</code><br />
but:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb66-1"><a href="data-manipulations.html#cb66-1"></a>cv08<span class="sc">$</span>lftop_new <span class="ot">&lt;-</span>  cv08<span class="sc">$</span>lftop</span></code></pre></div>
<p>You probably already noticed that to assign values to a new object we use <code>&lt;-</code> What we now want to do is to replace those values of our new variable <code>cv08$lftop_new</code> which have the values <strong>Onbekend</strong>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb67-1"><a href="data-manipulations.html#cb67-1"></a>cv08<span class="sc">$</span>lftop_new[cv08<span class="sc">$</span>lftop_new<span class="sc">==</span><span class="st">&quot;Onbekend&quot;</span>] <span class="ot">&lt;-</span>  <span class="cn">NA</span></span></code></pre></div>
<p>Dont forget, if you want to understand the code work inside out.</p>
<blockquote>
<p>Update your cheat sheet! Note that <code>==</code> is a logical operator. What are the other logical operators in R?<br />
Note that <code>[]</code> is used to subset elements from an object (e.g. dataframe/vector/matrix)<br />
Note that <code>NA</code> is used in R to define missing values. It means Not Applicable.</p>
</blockquote>
<p>So did our recode work?</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb68-1"><a href="data-manipulations.html#cb68-1"></a><span class="fu">table</span>(cv08<span class="sc">$</span>lftop_new, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
## &lt; één jaar   één jaar   125 jaar         16         17         18         19  twee jaar         20 
##          0          0          0         40         37         39         30          0         30 
##         21         22         23         24         25         26         27         28         29 
##         25         25         38         26         22         18         23         29         30 
##         30         31         32         33         34         35         36         37         38 
##         22         28         23         23         24         38         35         37         34 
##         39         40         41         42         43         44         45         46         47 
##         48         45         34         36         39         43         38         41         32 
##         48         49         50         51         52         53         54         55         56 
##         41         45         29         29         43         32         25         27         27 
##         57         58         59         60         61         62         63         64         65 
##         30         44         34         33         36         40         29         27         30 
##         66         67         68         69         70         71         72         73         74 
##         19         24         24         24         23         21         13         15         26 
##         75         76         77         78         79         80         81         82         83 
##         10         14         17         13         13         10          7         10         10 
##         84         85         86         87         88         89         90         91   Onbekend 
##          7          6          3          8          2          3          1          3          0 
##       &lt;NA&gt; 
##          4</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb70-1"><a href="data-manipulations.html#cb70-1"></a><span class="fu">levels</span>(cv08<span class="sc">$</span>lftop_new)</span></code></pre></div>
<pre><code>##  [1] &quot;&lt; één jaar&quot; &quot;één jaar&quot;   &quot;125 jaar&quot;   &quot;16&quot;         &quot;17&quot;         &quot;18&quot;         &quot;19&quot;        
##  [8] &quot;twee jaar&quot;  &quot;20&quot;         &quot;21&quot;         &quot;22&quot;         &quot;23&quot;         &quot;24&quot;         &quot;25&quot;        
## [15] &quot;26&quot;         &quot;27&quot;         &quot;28&quot;         &quot;29&quot;         &quot;30&quot;         &quot;31&quot;         &quot;32&quot;        
## [22] &quot;33&quot;         &quot;34&quot;         &quot;35&quot;         &quot;36&quot;         &quot;37&quot;         &quot;38&quot;         &quot;39&quot;        
## [29] &quot;40&quot;         &quot;41&quot;         &quot;42&quot;         &quot;43&quot;         &quot;44&quot;         &quot;45&quot;         &quot;46&quot;        
## [36] &quot;47&quot;         &quot;48&quot;         &quot;49&quot;         &quot;50&quot;         &quot;51&quot;         &quot;52&quot;         &quot;53&quot;        
## [43] &quot;54&quot;         &quot;55&quot;         &quot;56&quot;         &quot;57&quot;         &quot;58&quot;         &quot;59&quot;         &quot;60&quot;        
## [50] &quot;61&quot;         &quot;62&quot;         &quot;63&quot;         &quot;64&quot;         &quot;65&quot;         &quot;66&quot;         &quot;67&quot;        
## [57] &quot;68&quot;         &quot;69&quot;         &quot;70&quot;         &quot;71&quot;         &quot;72&quot;         &quot;73&quot;         &quot;74&quot;        
## [64] &quot;75&quot;         &quot;76&quot;         &quot;77&quot;         &quot;78&quot;         &quot;79&quot;         &quot;80&quot;         &quot;81&quot;        
## [71] &quot;82&quot;         &quot;83&quot;         &quot;84&quot;         &quot;85&quot;         &quot;86&quot;         &quot;87&quot;         &quot;88&quot;        
## [78] &quot;89&quot;         &quot;90&quot;         &quot;91&quot;         &quot;Onbekend&quot;</code></pre>
<p>But we want age as numeric variable not as a factor (categorical).</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb72-1"><a href="data-manipulations.html#cb72-1"></a><span class="fu">str</span>(cv08<span class="sc">$</span>lftop_new)</span></code></pre></div>
<pre><code>##  Factor w/ 81 levels &quot;&lt; één jaar&quot;,&quot;één jaar&quot;,..: 40 28 4 18 46 38 51 23 48 30 ...</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb74-1"><a href="data-manipulations.html#cb74-1"></a>cv08<span class="sc">$</span>agen <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(cv08<span class="sc">$</span>lftop_new))</span>
<span id="cb74-2"><a href="data-manipulations.html#cb74-2"></a><span class="fu">table</span>(cv08<span class="sc">$</span>agen, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32   33   34   35 
##   40   37   39   30   30   25   25   38   26   22   18   23   29   30   22   28   23   23   24   38 
##   36   37   38   39   40   41   42   43   44   45   46   47   48   49   50   51   52   53   54   55 
##   35   37   34   48   45   34   36   39   43   38   41   32   41   45   29   29   43   32   25   27 
##   56   57   58   59   60   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75 
##   27   30   44   34   33   36   40   29   27   30   19   24   24   24   23   21   13   15   26   10 
##   76   77   78   79   80   81   82   83   84   85   86   87   88   89   90   91 &lt;NA&gt; 
##   14   17   13   13   10    7   10   10    7    6    3    8    2    3    1    3    4</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb76-1"><a href="data-manipulations.html#cb76-1"></a><span class="fu">str</span>(cv08<span class="sc">$</span>agen)</span></code></pre></div>
<pre><code>##  num [1:1963] 51 39 16 29 57 49 62 34 59 41 ...</code></pre>
<blockquote>
<p>Hint: R is case sensitive. Just try to avoid capitals in your variable names. There are people who have set up a whole list of rules how to name and label stuff. Interesting? You can have a look <a href="https://style.tidyverse.org/">here</a>.<br />
I will use all_lower_case_underscore_seperated.<br />
Add to your cheat sheet <code>as.character()</code> and <code>as.numeric()</code>.</p>
</blockquote>
</div>
<div id="tidy" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Tidy</h3>
<p>Copy the variable<br />
We will ‘mutate’ the original dataset by adding a variable.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb78-1"><a href="data-manipulations.html#cb78-1"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">lftop_new=</span>lftop)</span></code></pre></div>
<p>Replace missings<br />
Be aware that the value <strong>99</strong> is the “onbekend” category.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb79-1"><a href="data-manipulations.html#cb79-1"></a>cv08_haven<span class="sc">$</span>lftop_new <span class="ot">&lt;-</span> <span class="fu">na_if</span>(cv08_haven<span class="sc">$</span>lftop_new, <span class="dv">99</span>)</span></code></pre></div>
<p>Normally you would combine these two steps into one</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb80-1"><a href="data-manipulations.html#cb80-1"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">lftop_new=</span><span class="fu">na_if</span>(lftop, <span class="dv">99</span>))</span></code></pre></div>
<p>check</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb81-1"><a href="data-manipulations.html#cb81-1"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>lftop_new, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32   33   34   35 
##   40   37   39   30   30   25   25   38   26   22   18   23   29   30   22   28   23   23   24   38 
##   36   37   38   39   40   41   42   43   44   45   46   47   48   49   50   51   52   53   54   55 
##   35   37   34   48   45   34   36   39   43   38   41   32   41   45   29   29   43   32   25   27 
##   56   57   58   59   60   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75 
##   27   30   44   34   33   36   40   29   27   30   19   24   24   24   23   21   13   15   26   10 
##   76   77   78   79   80   81   82   83   84   85   86   87   88   89   90   91 &lt;NA&gt; 
##   14   17   13   13   10    7   10   10    7    6    3    8    2    3    1    3    4</code></pre>
<p>An advantage of the tidy way is that it is more intuitive and requires less subsetting.<br />
A disadvantage is that you need to know more specific functions.</p>
<blockquote>
<p>Hint: In your cheat sheet, make a distinction between all the stuff that belongs to R Base and all specific functions, operators, etc. that are part of Tidyverse.<br />
How do you know it is part of Tidyverse? Well, if you don’t load tidyverse, the code will not work.</p>
</blockquote>
</div>
</div>
<div id="recoding-variables" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Recoding variables</h2>
<p>So, we defined a missing value for age. As a second example let us recode the variable education. This one is called <strong>var006n</strong> in CV08. Lets create a new variable <strong>educ3</strong> with three levels:<br />
1. primary<br />
2. secondary<br />
3. tertiary</p>
<div id="r-base-1" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> R Base</h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb83-1"><a href="data-manipulations.html#cb83-1"></a><span class="fu">levels</span>(cv08<span class="sc">$</span>var006n)</span></code></pre></div>
<pre><code>##  [1] &quot;onbekend&quot;                               &quot;OP &lt; 12 jr  of volgt actueel bas.ondw.&quot;
##  [3] &quot;basisonderwijs&quot;                         &quot;vmbo&quot;                                  
##  [5] &quot;mavo&quot;                                   &quot;havo/vwo&quot;                              
##  [7] &quot;mbo&quot;                                    &quot;hbo&quot;                                   
##  [9] &quot;wo&quot;                                     &quot;wo_duplicated_8&quot;                       
## [11] &quot;Onbekend&quot;</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb85-1"><a href="data-manipulations.html#cb85-1"></a><span class="fu">table</span>(cv08<span class="sc">$</span>var006n, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##                               onbekend OP &lt; 12 jr  of volgt actueel bas.ondw. 
##                                      5                                      0 
##                         basisonderwijs                                   vmbo 
##                                    380                                    287 
##                                   mavo                               havo/vwo 
##                                    137                                    106 
##                                    mbo                                    hbo 
##                                    543                                    339 
##                                     wo                        wo_duplicated_8 
##                                      0                                    166 
##                               Onbekend                                   &lt;NA&gt; 
##                                      0                                      0</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb87-1"><a href="data-manipulations.html#cb87-1"></a><span class="co">#lets make it a numeric var first</span></span>
<span id="cb87-2"><a href="data-manipulations.html#cb87-2"></a>cv08<span class="sc">$</span>educn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv08<span class="sc">$</span>var006n)</span>
<span id="cb87-3"><a href="data-manipulations.html#cb87-3"></a><span class="co">#check</span></span>
<span id="cb87-4"><a href="data-manipulations.html#cb87-4"></a><span class="fu">table</span>(cv08<span class="sc">$</span>educn, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    1    3    4    5    6    7    8   10 &lt;NA&gt; 
##    5  380  287  137  106  543  339  166    0</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb89-1"><a href="data-manipulations.html#cb89-1"></a><span class="co">#start with an empty variable</span></span>
<span id="cb89-2"><a href="data-manipulations.html#cb89-2"></a>cv08<span class="sc">$</span>educ3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb89-3"><a href="data-manipulations.html#cb89-3"></a><span class="co">#fill category by category</span></span>
<span id="cb89-4"><a href="data-manipulations.html#cb89-4"></a>cv08<span class="sc">$</span>educ3[cv08<span class="sc">$</span>educn<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> cv08<span class="sc">$</span>educn<span class="sc">==</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb89-5"><a href="data-manipulations.html#cb89-5"></a>cv08<span class="sc">$</span>educ3[cv08<span class="sc">$</span>educn<span class="sc">&gt;</span><span class="dv">3</span> <span class="sc">&amp;</span> cv08<span class="sc">$</span>educn<span class="sc">&lt;</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb89-6"><a href="data-manipulations.html#cb89-6"></a>cv08<span class="sc">$</span>educ3[cv08<span class="sc">$</span>educn<span class="sc">&gt;</span><span class="dv">7</span> <span class="sc">&amp;</span> cv08<span class="sc">$</span>educn<span class="sc">&lt;</span><span class="dv">11</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb89-7"><a href="data-manipulations.html#cb89-7"></a></span>
<span id="cb89-8"><a href="data-manipulations.html#cb89-8"></a><span class="co">#check</span></span>
<span id="cb89-9"><a href="data-manipulations.html#cb89-9"></a><span class="fu">table</span>(cv08<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    1    2    3 &lt;NA&gt; 
##  380 1073  505    5</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb91-1"><a href="data-manipulations.html#cb91-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(cv08<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>))</span></code></pre></div>
<pre><code>## 
##           1           2           3        &lt;NA&gt; 
## 0.193581253 0.546612328 0.257259297 0.002547122</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb93-1"><a href="data-manipulations.html#cb93-1"></a><span class="co">#now educ3 is a numeric variable, we want it as factor</span></span>
<span id="cb93-2"><a href="data-manipulations.html#cb93-2"></a>cv08<span class="sc">$</span>educ3 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cv08<span class="sc">$</span>educ3)</span>
<span id="cb93-3"><a href="data-manipulations.html#cb93-3"></a><span class="fu">table</span>(cv08<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    1    2    3 &lt;NA&gt; 
##  380 1073  505    5</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb95-1"><a href="data-manipulations.html#cb95-1"></a><span class="fu">levels</span>(cv08<span class="sc">$</span>educ3) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)</span>
<span id="cb95-2"><a href="data-manipulations.html#cb95-2"></a><span class="fu">table</span>(cv08<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   primary secondary  tertiary      &lt;NA&gt; 
##       380      1073       505         5</code></pre>
<blockquote>
<p>Is this really the first time we encountered the function <code>c()</code>? Well, make sure it is somewhere at the top of your cheat sheet.</p>
</blockquote>
</div>
<div id="tidy-1" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Tidy</h3>
<p>And now the fun starts. Tidyverse includes a <code>dplyr::recode</code> function, but this function does not work on labelled variables imported via the haven package. Luckily, there is a package that extends the original function, <code>labelled</code>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb97-1"><a href="data-manipulations.html#cb97-1"></a><span class="co">#install.packages(&quot;labelled&quot;)</span></span>
<span id="cb97-2"><a href="data-manipulations.html#cb97-2"></a><span class="fu">require</span>(labelled) <span class="co">#to be able to use the recode function on haven labelled variables</span></span></code></pre></div>
<pre><code>## Loading required package: labelled</code></pre>
<pre><code>## Warning: package &#39;labelled&#39; was built under R version 4.0.5</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb100-1"><a href="data-manipulations.html#cb100-1"></a><span class="co">#inspect variable</span></span>
<span id="cb100-2"><a href="data-manipulations.html#cb100-2"></a><span class="fu">str</span>(cv08_haven<span class="sc">$</span>var006n)</span></code></pre></div>
<pre><code>##  dbl+lbl [1:1963] 6, 8, 3, 8, 6, 2, 2, 5, 5, 1, 1, 3, 2, 1, 1, 5, 6, 3, 1, 5, 6, 2, 5, 6, 1, 3,...
##  @ label        : chr &quot;Voltooid opleidingsniveau (uitgebreid) OP, 12-14 jarigen niet standaard op bas.ondw.&quot;
##  @ format.spss  : chr &quot;F10.0&quot;
##  @ display_width: int 12
##  @ labels       : Named num [1:11] -3 -1 1 2 3 4 5 6 7 8 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:11] &quot;onbekend&quot; &quot;OP &lt; 12 jr  of volgt actueel bas.ondw.&quot; &quot;basisonderwijs&quot; &quot;vmbo&quot; ...</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb102-1"><a href="data-manipulations.html#cb102-1"></a><span class="fu">attr</span>(cv08_haven<span class="sc">$</span>var006n, <span class="st">&quot;labels&quot;</span>)</span></code></pre></div>
<pre><code>##                               onbekend OP &lt; 12 jr  of volgt actueel bas.ondw. 
##                                 -3e+00                                 -1e+00 
##                         basisonderwijs                                   vmbo 
##                                  1e+00                                  2e+00 
##                                   mavo                               havo/vwo 
##                                  3e+00                                  4e+00 
##                                    mbo                                    hbo 
##                                  5e+00                                  6e+00 
##                                     wo                                     wo 
##                                  7e+00                                  8e+00 
##                               Onbekend 
##                                  1e+10</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb104-1"><a href="data-manipulations.html#cb104-1"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>var006n, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   -3    1    2    3    4    5    6    8 &lt;NA&gt; 
##    5  380  287  137  106  543  339  166    0</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb106-1"><a href="data-manipulations.html#cb106-1"></a><span class="co">#recode values, all missings as one value</span></span>
<span id="cb106-2"><a href="data-manipulations.html#cb106-2"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">educ3=</span><span class="fu">recode</span>(var006n, <span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">2</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;5&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;6&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;7&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;8&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;10&#39;</span><span class="ot">=</span> <span class="sc">-</span><span class="dv">9</span>), <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb106-3"><a href="data-manipulations.html#cb106-3"></a></span>
<span id="cb106-4"><a href="data-manipulations.html#cb106-4"></a><span class="co">#replace missing values with NA.</span></span>
<span id="cb106-5"><a href="data-manipulations.html#cb106-5"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">educ3=</span><span class="fu">na_if</span>(educ3, <span class="sc">-</span><span class="dv">9</span>))</span>
<span id="cb106-6"><a href="data-manipulations.html#cb106-6"></a></span>
<span id="cb106-7"><a href="data-manipulations.html#cb106-7"></a><span class="co">#make educ3 a factor</span></span>
<span id="cb106-8"><a href="data-manipulations.html#cb106-8"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">educ3=</span><span class="fu">factor</span>(educ3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb106-9"><a href="data-manipulations.html#cb106-9"></a><span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)))</span>
<span id="cb106-10"><a href="data-manipulations.html#cb106-10"></a></span>
<span id="cb106-11"><a href="data-manipulations.html#cb106-11"></a><span class="co">#check</span></span>
<span id="cb106-12"><a href="data-manipulations.html#cb106-12"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   primary secondary  tertiary      &lt;NA&gt; 
##       380      1073       505         5</code></pre>
<p>Personally, I think this is all quite complicated. But I guess this is a matter of taste.</p>
<p>And advantage of the Tidy way is that you could use the <code>%&gt;%</code>, piping, operator. Now, your code does not read from the inside out but from left to right. For many people this is more intuitive. The output of the function on the left is transported to the (first argument of the) function on the right. Thus, in the example below, you see that in the second and third call to mutate I don’t have to tell the function which dataset I am using.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb108-1"><a href="data-manipulations.html#cb108-1"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">educ3=</span><span class="fu">recode</span>(var006n, <span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">2</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;5&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;6&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;7&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;8&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;10&#39;</span><span class="ot">=</span> <span class="sc">-</span><span class="dv">9</span>), <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb108-2"><a href="data-manipulations.html#cb108-2"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">na_if</span>(educ3, <span class="sc">-</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="data-manipulations.html#cb108-3"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">factor</span>(educ3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)))</span></code></pre></div>
<p>Perhaps an even tidier way would be:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb109-1"><a href="data-manipulations.html#cb109-1"></a>cv08_haven <span class="ot">&lt;-</span> cv08_haven <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="data-manipulations.html#cb109-2"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">recode</span>(var006n, <span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">2</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;5&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;6&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;7&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;8&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;10&#39;</span><span class="ot">=</span> <span class="sc">-</span><span class="dv">9</span>), <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb109-3"><a href="data-manipulations.html#cb109-3"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">na_if</span>(educ3, <span class="sc">-</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="data-manipulations.html#cb109-4"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">factor</span>(educ3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)))</span></code></pre></div>
<p>In the example above, it still may ‘feel’ a little clumsy to have to make a call to the same <code>mutate</code> function three times. Well, this is indeed not necessary.</p>
<p>Thus, the most tidy way is:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb110-1"><a href="data-manipulations.html#cb110-1"></a>cv08_haven <span class="ot">&lt;-</span> cv08_haven <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="data-manipulations.html#cb110-2"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">recode</span>(var006n, <span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">2</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;5&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;6&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;7&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;8&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;10&#39;</span><span class="ot">=</span> <span class="sc">-</span><span class="dv">9</span>, <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>),</span>
<span id="cb110-3"><a href="data-manipulations.html#cb110-3"></a>         <span class="at">educ3=</span><span class="fu">na_if</span>(educ3, <span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb110-4"><a href="data-manipulations.html#cb110-4"></a>         <span class="at">educ3=</span><span class="fu">factor</span>(educ3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)))</span></code></pre></div>
</div>
</div>
<div id="means-and-counting-specific-values" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Means and counting specific values</h2>
<div id="r-base-2" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> R Base</h3>
<p>Next step. Lets calculate a mean. We will use three questions in CV on polarization. This does not make any theoretical sense of course.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb111-1"><a href="data-manipulations.html#cb111-1"></a><span class="co">#Step 1: have a look at the vars</span></span>
<span id="cb111-2"><a href="data-manipulations.html#cb111-2"></a><span class="fu">summary</span>(cv08<span class="sc">$</span>int055)</span></code></pre></div>
<pre><code>##                 Geen opgave                      N.v.t.                   Weet niet 
##                           0                           0                          85 
##                     Weigert                  Zeer groot                       Groot 
##                           0                          57                         551 
##               Niet zo groot Helemaal geen tegenstelling 
##                        1213                          57</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb113-1"><a href="data-manipulations.html#cb113-1"></a><span class="fu">summary</span>(cv08<span class="sc">$</span>int056)</span></code></pre></div>
<pre><code>##                 Geen opgave                      N.v.t.                   Weet niet 
##                           0                           0                         118 
##                     Weigert                  Zeer groot                       Groot 
##                           0                         258                         987 
##               Niet zo groot Helemaal geen tegenstelling 
##                         571                          29</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb115-1"><a href="data-manipulations.html#cb115-1"></a><span class="fu">summary</span>(cv08<span class="sc">$</span>int057)</span></code></pre></div>
<pre><code>##                 Geen opgave                      N.v.t.                   Weet niet 
##                           0                           0                         145 
##                     Weigert                  Zeer groot                       Groot 
##                           0                         213                         803 
##               Niet zo groot Helemaal geen tegenstelling 
##                         756                          46</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb117-1"><a href="data-manipulations.html#cb117-1"></a><span class="co">#Step 2: make numeric</span></span>
<span id="cb117-2"><a href="data-manipulations.html#cb117-2"></a>cv08<span class="sc">$</span>int055n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv08<span class="sc">$</span>int055)</span>
<span id="cb117-3"><a href="data-manipulations.html#cb117-3"></a><span class="fu">table</span>(cv08<span class="sc">$</span>int055n, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    3    5    6    7    8 &lt;NA&gt; 
##   85   57  551 1213   57    0</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb119-1"><a href="data-manipulations.html#cb119-1"></a>cv08<span class="sc">$</span>int056n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv08<span class="sc">$</span>int056)</span>
<span id="cb119-2"><a href="data-manipulations.html#cb119-2"></a><span class="fu">table</span>(cv08<span class="sc">$</span>int056n, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    3    5    6    7    8 &lt;NA&gt; 
##  118  258  987  571   29    0</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb121-1"><a href="data-manipulations.html#cb121-1"></a>cv08<span class="sc">$</span>int057n <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv08<span class="sc">$</span>int057)</span>
<span id="cb121-2"><a href="data-manipulations.html#cb121-2"></a><span class="fu">table</span>(cv08<span class="sc">$</span>int057n, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    3    5    6    7    8 &lt;NA&gt; 
##  145  213  803  756   46    0</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb123-1"><a href="data-manipulations.html#cb123-1"></a><span class="co">#Step 3: define missings and recode</span></span>
<span id="cb123-2"><a href="data-manipulations.html#cb123-2"></a>cv08<span class="sc">$</span>int055n[cv08<span class="sc">$</span>int055n<span class="sc">&lt;</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb123-3"><a href="data-manipulations.html#cb123-3"></a>cv08<span class="sc">$</span>int055n <span class="ot">&lt;-</span> cv08<span class="sc">$</span>int055n  <span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb123-4"><a href="data-manipulations.html#cb123-4"></a>cv08<span class="sc">$</span>int056n[cv08<span class="sc">$</span>int056n<span class="sc">&lt;</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb123-5"><a href="data-manipulations.html#cb123-5"></a>cv08<span class="sc">$</span>int056n <span class="ot">&lt;-</span> cv08<span class="sc">$</span>int056n  <span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb123-6"><a href="data-manipulations.html#cb123-6"></a>cv08<span class="sc">$</span>int057n[cv08<span class="sc">$</span>int057n<span class="sc">&lt;</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb123-7"><a href="data-manipulations.html#cb123-7"></a>cv08<span class="sc">$</span>int057n <span class="ot">&lt;-</span> cv08<span class="sc">$</span>int057n  <span class="sc">-</span> <span class="dv">4</span></span>
<span id="cb123-8"><a href="data-manipulations.html#cb123-8"></a></span>
<span id="cb123-9"><a href="data-manipulations.html#cb123-9"></a><span class="co">#Step 4: calculate means. </span></span>
<span id="cb123-10"><a href="data-manipulations.html#cb123-10"></a><span class="co">#How does the function mean work in R?</span></span>
<span id="cb123-11"><a href="data-manipulations.html#cb123-11"></a><span class="fu">mean</span>(cv08<span class="sc">$</span>int055n)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb125-1"><a href="data-manipulations.html#cb125-1"></a><span class="fu">mean</span>(cv08<span class="sc">$</span>int055n, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 2.676251</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb127-1"><a href="data-manipulations.html#cb127-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(cv08<span class="sc">$</span>int055n, cv08<span class="sc">$</span>int056n, cv08<span class="sc">$</span>int057n), <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>## [1] 2.410756</code></pre>
<p>This is not what we want. What we want is to calculate a mean for each row/respondent. This will do the trick:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb129-1"><a href="data-manipulations.html#cb129-1"></a>testmeans <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(cv08<span class="sc">$</span>int055n, cv08<span class="sc">$</span>int056n, cv08<span class="sc">$</span>int057n), <span class="at">na.rm =</span> T)</span>
<span id="cb129-2"><a href="data-manipulations.html#cb129-2"></a><span class="fu">head</span>(testmeans)</span></code></pre></div>
<pre><code>## [1] 2.333333 2.666667 2.666667 2.333333 1.500000 1.333333</code></pre>
<p>What we really want is a mean but only if there is a maximum of 1 NA in the three variables.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb131-1"><a href="data-manipulations.html#cb131-1"></a><span class="co">#lets first count how many missings we have for each respondent</span></span>
<span id="cb131-2"><a href="data-manipulations.html#cb131-2"></a>nmis <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">is.na</span>(<span class="fu">cbind</span>(cv08<span class="sc">$</span>int055n, cv08<span class="sc">$</span>int056n, cv08<span class="sc">$</span>int057n)))</span>
<span id="cb131-3"><a href="data-manipulations.html#cb131-3"></a></span>
<span id="cb131-4"><a href="data-manipulations.html#cb131-4"></a><span class="co"># ?is.na</span></span>
<span id="cb131-5"><a href="data-manipulations.html#cb131-5"></a><span class="co"># ?rowSums</span></span>
<span id="cb131-6"><a href="data-manipulations.html#cb131-6"></a></span>
<span id="cb131-7"><a href="data-manipulations.html#cb131-7"></a>testmeans <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nmis<span class="sc">&lt;</span><span class="dv">2</span>,testmeans, <span class="cn">NA</span>)</span>
<span id="cb131-8"><a href="data-manipulations.html#cb131-8"></a></span>
<span id="cb131-9"><a href="data-manipulations.html#cb131-9"></a><span class="co">#add the calculated means to our dataset</span></span>
<span id="cb131-10"><a href="data-manipulations.html#cb131-10"></a>cv08<span class="sc">$</span>int_mean <span class="ot">&lt;-</span> testmeans</span>
<span id="cb131-11"><a href="data-manipulations.html#cb131-11"></a></span>
<span id="cb131-12"><a href="data-manipulations.html#cb131-12"></a><span class="co">#Bonus: count specific values</span></span>
<span id="cb131-13"><a href="data-manipulations.html#cb131-13"></a><span class="co">#so now we have this, it is easy to find how many times respondents answered &#39;zeer groot&#39;, that is &#39;1&#39;</span></span>
<span id="cb131-14"><a href="data-manipulations.html#cb131-14"></a>timesZG <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">cbind</span>(cv08<span class="sc">$</span>int055n, cv08<span class="sc">$</span>int056n, cv08<span class="sc">$</span>int057n)<span class="sc">==</span><span class="dv">1</span>, <span class="at">na.rm=</span>T)</span></code></pre></div>
<blockquote>
<p>You need to add a lot of very powerful functions to your cheat sheet: <code>mean()</code>, <code>rowMeans()</code>, <code>rowSums</code>, <code>cbind()</code>, <code>is.na()</code>, <code>ifelse().</code></p>
<p>Did you also notice that the logicals <strong>FALSE</strong> and T<strong>RUE</strong> can be summed? (FALSE equals 0 and TRUE equals 1).</p>
</blockquote>
</div>
<div id="tidy-2" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Tidy</h3>
<div class="sourceCode" id="cb132"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb132-1"><a href="data-manipulations.html#cb132-1"></a><span class="co">#Step 1: have a look at the vars</span></span>
<span id="cb132-2"><a href="data-manipulations.html#cb132-2"></a><span class="fu">str</span>(cv08_haven<span class="sc">$</span>int055)</span></code></pre></div>
<pre><code>##  dbl+lbl [1:1963]  3,  3,  3,  2, -3,  1,  2,  3,  3,  2,  2,  3,  3,  3,  3,  2,  3,  2,  3,  ...
##  @ label        : chr &quot;Tegenstelling arbeidersklasse en middenklasse&quot;
##  @ format.spss  : chr &quot;F10.0&quot;
##  @ display_width: int 12
##  @ labels       : Named num [1:8] -6 -5 -3 -2 1 2 3 4
##   ..- attr(*, &quot;names&quot;)= chr [1:8] &quot;Geen opgave&quot; &quot;N.v.t.&quot; &quot;Weet niet&quot; &quot;Weigert&quot; ...</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb134-1"><a href="data-manipulations.html#cb134-1"></a><span class="fu">attr</span>(cv08_haven<span class="sc">$</span>int055, <span class="st">&quot;labels&quot;</span>)</span></code></pre></div>
<pre><code>##                 Geen opgave                      N.v.t.                   Weet niet 
##                          -6                          -5                          -3 
##                     Weigert                  Zeer groot                       Groot 
##                          -2                           1                           2 
##               Niet zo groot Helemaal geen tegenstelling 
##                           3                           4</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb136-1"><a href="data-manipulations.html#cb136-1"></a><span class="fu">summary</span>(cv08_haven<span class="sc">$</span>int055)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   -3.00    2.00    3.00    2.43    3.00    4.00</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb138-1"><a href="data-manipulations.html#cb138-1"></a><span class="fu">summary</span>(cv08_haven<span class="sc">$</span>int056)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  -3.000   2.000   2.000   1.888   3.000   4.000</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb140-1"><a href="data-manipulations.html#cb140-1"></a><span class="fu">summary</span>(cv08_haven<span class="sc">$</span>int057)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  -3.000   2.000   2.000   1.954   3.000   4.000</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb142-1"><a href="data-manipulations.html#cb142-1"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>int055n, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `int055n`.</code></pre>
<pre><code>## 
## &lt;NA&gt; 
##    0</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb145-1"><a href="data-manipulations.html#cb145-1"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>int056, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   -3    1    2    3    4 &lt;NA&gt; 
##  118  258  987  571   29    0</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb147-1"><a href="data-manipulations.html#cb147-1"></a><span class="fu">table</span>(cv08_haven<span class="sc">$</span>int057, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   -3    1    2    3    4 &lt;NA&gt; 
##  145  213  803  756   46    0</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb149-1"><a href="data-manipulations.html#cb149-1"></a><span class="co">#Step 2: define missings and recode</span></span>
<span id="cb149-2"><a href="data-manipulations.html#cb149-2"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">int055n=</span><span class="fu">recode</span>(int055, <span class="st">&#39;-6&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-5&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>,<span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>,<span class="st">&#39;-2&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">4</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">3</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">1</span>), <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="data-manipulations.html#cb149-3"></a>  <span class="fu">mutate</span>(<span class="at">int055n=</span><span class="fu">na_if</span>(int055n, <span class="sc">-</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb149-4"><a href="data-manipulations.html#cb149-4"></a>  <span class="fu">mutate</span>(<span class="at">int055n=</span><span class="fu">labelled</span>(int055n, <span class="fu">c</span>(<span class="st">&quot;Helemaal geen tegenstelling&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Niet zo groot&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;Groot&quot;</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">&quot;Zeer groot&quot;</span><span class="ot">=</span><span class="dv">4</span>)))</span>
<span id="cb149-5"><a href="data-manipulations.html#cb149-5"></a></span>
<span id="cb149-6"><a href="data-manipulations.html#cb149-6"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">int056n=</span><span class="fu">recode</span>(int056, <span class="st">&#39;-6&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-5&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>,<span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>,<span class="st">&#39;-2&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">4</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">3</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">1</span>), <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-7"><a href="data-manipulations.html#cb149-7"></a>  <span class="fu">mutate</span>(<span class="at">int056n=</span><span class="fu">na_if</span>(int056n, <span class="sc">-</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb149-8"><a href="data-manipulations.html#cb149-8"></a>  <span class="fu">mutate</span>(<span class="at">int056n=</span><span class="fu">labelled</span>(int056n, <span class="fu">c</span>(<span class="st">&quot;Helemaal geen tegenstelling&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Niet zo groot&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;Groot&quot;</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">&quot;Zeer groot&quot;</span><span class="ot">=</span><span class="dv">4</span>)))</span>
<span id="cb149-9"><a href="data-manipulations.html#cb149-9"></a></span>
<span id="cb149-10"><a href="data-manipulations.html#cb149-10"></a>cv08_haven <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cv08_haven, <span class="at">int057n=</span><span class="fu">recode</span>(int057, <span class="st">&#39;-6&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-5&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>,<span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>,<span class="st">&#39;-2&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">4</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">3</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">1</span>), <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-11"><a href="data-manipulations.html#cb149-11"></a>  <span class="fu">mutate</span>(<span class="at">int057n=</span><span class="fu">na_if</span>(int057n, <span class="sc">-</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb149-12"><a href="data-manipulations.html#cb149-12"></a>  <span class="fu">mutate</span>(<span class="at">int057n=</span><span class="fu">labelled</span>(int057n, <span class="fu">c</span>(<span class="st">&quot;Helemaal geen tegenstelling&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Niet zo groot&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;Groot&quot;</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">&quot;Zeer groot&quot;</span><span class="ot">=</span><span class="dv">4</span>)))</span>
<span id="cb149-13"><a href="data-manipulations.html#cb149-13"></a></span>
<span id="cb149-14"><a href="data-manipulations.html#cb149-14"></a></span>
<span id="cb149-15"><a href="data-manipulations.html#cb149-15"></a><span class="co">#Step 3: calculate means. </span></span>
<span id="cb149-16"><a href="data-manipulations.html#cb149-16"></a><span class="do">## option 1</span></span>
<span id="cb149-17"><a href="data-manipulations.html#cb149-17"></a>cv08_haven <span class="ot">&lt;-</span> cv08_haven <span class="sc">%&gt;%</span> </span>
<span id="cb149-18"><a href="data-manipulations.html#cb149-18"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb149-19"><a href="data-manipulations.html#cb149-19"></a>  <span class="fu">mutate</span>(<span class="at">int_mean =</span> <span class="fu">mean</span>(<span class="fu">c</span>(int055n, int056n, int057n), <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb149-20"><a href="data-manipulations.html#cb149-20"></a></span>
<span id="cb149-21"><a href="data-manipulations.html#cb149-21"></a></span>
<span id="cb149-22"><a href="data-manipulations.html#cb149-22"></a><span class="do">## option 2</span></span>
<span id="cb149-23"><a href="data-manipulations.html#cb149-23"></a>cv08_haven <span class="sc">%&gt;%</span> </span>
<span id="cb149-24"><a href="data-manipulations.html#cb149-24"></a>  <span class="fu">mutate</span>(<span class="at">int_mean =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(int055n, int056n, int057n), <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,963 x 285
## # Rowwise: 
##      we_id  veilignr   lft1 geslacht  allochtn lft01 lftop gewicht var006n    v040   var723  var723a
##    &lt;dbl+l&gt;     &lt;dbl&gt; &lt;dbl+&gt; &lt;chr+lbl&gt; &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt;
##  1  3.68e7 811002474     51 M [Man]   0 [geen~    50    51   8423. 6 [hbo] 2 [Nee] -5 [N.v~ -5 [N.v~
##  2  3.68e7 811002539     39 V [Vrouw] 0 [geen~    38    39   6244. 8 [wo]  1 [Ja]  45       -5 [N.v~
##  3  3.68e7 811002551     16 V [Vrouw] 1 [allo~    15    16  13434. 3 [mav~ 2 [Nee] -5 [N.v~ -5 [N.v~
##  4  3.68e7 811002563     30 M [Man]   0 [geen~    29    29   8997  8 [wo]  1 [Ja]  20       -5 [N.v~
##  5  3.68e7 811002743     57 M [Man]   0 [geen~    56    57   8423. 6 [hbo] 2 [Nee] -5 [N.v~ -5 [N.v~
##  6  3.68e7 811002607     49 V [Vrouw] 1 [allo~    48    49   9537. 2 [vmb~ 2 [Nee] -5 [N.v~ -5 [N.v~
##  7  3.68e7 811002652     62 M [Man]   0 [geen~    61    62   8882. 2 [vmb~ 1 [Ja]  40       -5 [N.v~
##  8  3.68e7 811002741     34 V [Vrouw] 1 [allo~    33    34   5768. 5 [mbo] 1 [Ja]  32       -5 [N.v~
##  9  3.68e7 811002774     59 M [Man]   0 [geen~    58    59   7986. 5 [mbo] 1 [Ja]  30       -5 [N.v~
## 10  3.68e7 811002714     41 M [Man]   0 [geen~    40    41   9108. 1 [bas~ 1 [Ja]  20       -5 [N.v~
## # ... with 1,953 more rows, and 273 more variables: v202n &lt;dbl+lbl&gt;, var1061a &lt;dbl+lbl&gt;,
## #   var1061b &lt;dbl+lbl&gt;, var1062a &lt;dbl+lbl&gt;, var1062b &lt;dbl+lbl&gt;, int137n &lt;dbl+lbl&gt;,
## #   int138n &lt;dbl+lbl&gt;, int139n &lt;dbl+lbl&gt;, int140n &lt;dbl+lbl&gt;, int141n &lt;dbl+lbl&gt;, v401 &lt;dbl+lbl&gt;,
## #   var1343 &lt;dbl+lbl&gt;, var648 &lt;dbl+lbl&gt;, var149 &lt;dbl+lbl&gt;, var058 &lt;dbl+lbl&gt;, var059 &lt;dbl+lbl&gt;,
## #   var064 &lt;dbl+lbl&gt;, var365 &lt;dbl+lbl&gt;, var065 &lt;dbl+lbl&gt;, var092 &lt;dbl+lbl&gt;, var096 &lt;dbl+lbl&gt;,
## #   int054 &lt;dbl+lbl&gt;, int055 &lt;dbl+lbl&gt;, int056 &lt;dbl+lbl&gt;, int057 &lt;dbl+lbl&gt;, int058 &lt;dbl+lbl&gt;,
## #   int059 &lt;dbl+lbl&gt;, int059a &lt;dbl+lbl&gt;, var571 &lt;dbl+lbl&gt;, var572 &lt;dbl+lbl&gt;, var573 &lt;dbl+lbl&gt;,
## #   var574 &lt;dbl+lbl&gt;, var576 &lt;dbl+lbl&gt;, var153 &lt;dbl+lbl&gt;, var154 &lt;dbl+lbl&gt;, var155 &lt;dbl+lbl&gt;,
## #   var156 &lt;dbl+lbl&gt;, var157 &lt;dbl+lbl&gt;, var157a &lt;dbl+lbl&gt;, var154a &lt;dbl+lbl&gt;, var164 &lt;dbl+lbl&gt;,
## #   var165 &lt;dbl+lbl&gt;, var166 &lt;dbl+lbl&gt;, var179 &lt;dbl+lbl&gt;, var180 &lt;dbl+lbl&gt;, var184 &lt;dbl+lbl&gt;,
## #   var185 &lt;dbl+lbl&gt;, var198a &lt;dbl+lbl&gt;, var198 &lt;dbl+lbl&gt;, var201a &lt;dbl+lbl&gt;, var201b &lt;dbl+lbl&gt;,
## #   var204 &lt;dbl+lbl&gt;, int257 &lt;dbl+lbl&gt;, var211 &lt;dbl+lbl&gt;, var223 &lt;dbl+lbl&gt;, var1320 &lt;dbl+lbl&gt;,
## #   var1321 &lt;dbl+lbl&gt;, var1322 &lt;dbl+lbl&gt;, var1323 &lt;dbl+lbl&gt;, var1324 &lt;dbl+lbl&gt;, var1325 &lt;dbl+lbl&gt;,
## #   var1326 &lt;dbl+lbl&gt;, var1327 &lt;dbl+lbl&gt;, var1328 &lt;dbl+lbl&gt;, var229 &lt;dbl+lbl&gt;, int218 &lt;dbl+lbl&gt;,
## #   int219 &lt;dbl+lbl&gt;, int221 &lt;dbl+lbl&gt;, int222 &lt;dbl+lbl&gt;, int223 &lt;dbl+lbl&gt;, int710 &lt;dbl+lbl&gt;,
## #   int711 &lt;dbl+lbl&gt;, int712 &lt;dbl+lbl&gt;, int713 &lt;dbl+lbl&gt;, int714 &lt;dbl+lbl&gt;, int715 &lt;dbl+lbl&gt;,
## #   int716 &lt;dbl+lbl&gt;, var433 &lt;dbl+lbl&gt;, var439 &lt;dbl+lbl&gt;, var1329 &lt;dbl+lbl&gt;, var1330 &lt;dbl+lbl&gt;,
## #   var445 &lt;dbl+lbl&gt;, var446 &lt;dbl+lbl&gt;, var447 &lt;dbl+lbl&gt;, var451 &lt;dbl+lbl&gt;, var452 &lt;dbl+lbl&gt;,
## #   var1316 &lt;dbl+lbl&gt;, var1317 &lt;dbl+lbl&gt;, var1331 &lt;dbl+lbl&gt;, vw065 &lt;dbl+lbl&gt;, var491 &lt;dbl+lbl&gt;,
## #   var040 &lt;dbl+lbl&gt;, var1304 &lt;dbl+lbl&gt;, var274 &lt;dbl+lbl&gt;, var275 &lt;dbl+lbl&gt;, var1196 &lt;dbl+lbl&gt;,
## #   var1197 &lt;dbl+lbl&gt;, var461 &lt;dbl+lbl&gt;, var273 &lt;dbl+lbl&gt;, var1262 &lt;dbl+lbl&gt;, ...</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb151-1"><a href="data-manipulations.html#cb151-1"></a><span class="co">#what we really want is a mean but only if there is a maximum of 1 NA in the three variables</span></span>
<span id="cb151-2"><a href="data-manipulations.html#cb151-2"></a></span>
<span id="cb151-3"><a href="data-manipulations.html#cb151-3"></a>cv08_haven <span class="sc">%&gt;%</span> </span>
<span id="cb151-4"><a href="data-manipulations.html#cb151-4"></a>  <span class="fu">mutate</span>(<span class="at">int_mean_temp =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(int055n, int056n, int057n), <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb151-5"><a href="data-manipulations.html#cb151-5"></a>         <span class="at">nmis =</span> <span class="fu">rowSums</span>(<span class="fu">is.na</span>(<span class="fu">cbind</span>(int055n, int056n, int057n))), </span>
<span id="cb151-6"><a href="data-manipulations.html#cb151-6"></a>         <span class="at">int_mean =</span> <span class="fu">ifelse</span>(nmis<span class="sc">&lt;</span><span class="dv">2</span>, int_mean_temp, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb151-7"><a href="data-manipulations.html#cb151-7"></a>  <span class="fu">select</span>(<span class="sc">-</span>int_mean_temp, <span class="sc">-</span>nmis)</span></code></pre></div>
<pre><code>## # A tibble: 1,963 x 285
## # Rowwise: 
##      we_id  veilignr   lft1 geslacht  allochtn lft01 lftop gewicht var006n    v040   var723  var723a
##    &lt;dbl+l&gt;     &lt;dbl&gt; &lt;dbl+&gt; &lt;chr+lbl&gt; &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt;
##  1  3.68e7 811002474     51 M [Man]   0 [geen~    50    51   8423. 6 [hbo] 2 [Nee] -5 [N.v~ -5 [N.v~
##  2  3.68e7 811002539     39 V [Vrouw] 0 [geen~    38    39   6244. 8 [wo]  1 [Ja]  45       -5 [N.v~
##  3  3.68e7 811002551     16 V [Vrouw] 1 [allo~    15    16  13434. 3 [mav~ 2 [Nee] -5 [N.v~ -5 [N.v~
##  4  3.68e7 811002563     30 M [Man]   0 [geen~    29    29   8997  8 [wo]  1 [Ja]  20       -5 [N.v~
##  5  3.68e7 811002743     57 M [Man]   0 [geen~    56    57   8423. 6 [hbo] 2 [Nee] -5 [N.v~ -5 [N.v~
##  6  3.68e7 811002607     49 V [Vrouw] 1 [allo~    48    49   9537. 2 [vmb~ 2 [Nee] -5 [N.v~ -5 [N.v~
##  7  3.68e7 811002652     62 M [Man]   0 [geen~    61    62   8882. 2 [vmb~ 1 [Ja]  40       -5 [N.v~
##  8  3.68e7 811002741     34 V [Vrouw] 1 [allo~    33    34   5768. 5 [mbo] 1 [Ja]  32       -5 [N.v~
##  9  3.68e7 811002774     59 M [Man]   0 [geen~    58    59   7986. 5 [mbo] 1 [Ja]  30       -5 [N.v~
## 10  3.68e7 811002714     41 M [Man]   0 [geen~    40    41   9108. 1 [bas~ 1 [Ja]  20       -5 [N.v~
## # ... with 1,953 more rows, and 273 more variables: v202n &lt;dbl+lbl&gt;, var1061a &lt;dbl+lbl&gt;,
## #   var1061b &lt;dbl+lbl&gt;, var1062a &lt;dbl+lbl&gt;, var1062b &lt;dbl+lbl&gt;, int137n &lt;dbl+lbl&gt;,
## #   int138n &lt;dbl+lbl&gt;, int139n &lt;dbl+lbl&gt;, int140n &lt;dbl+lbl&gt;, int141n &lt;dbl+lbl&gt;, v401 &lt;dbl+lbl&gt;,
## #   var1343 &lt;dbl+lbl&gt;, var648 &lt;dbl+lbl&gt;, var149 &lt;dbl+lbl&gt;, var058 &lt;dbl+lbl&gt;, var059 &lt;dbl+lbl&gt;,
## #   var064 &lt;dbl+lbl&gt;, var365 &lt;dbl+lbl&gt;, var065 &lt;dbl+lbl&gt;, var092 &lt;dbl+lbl&gt;, var096 &lt;dbl+lbl&gt;,
## #   int054 &lt;dbl+lbl&gt;, int055 &lt;dbl+lbl&gt;, int056 &lt;dbl+lbl&gt;, int057 &lt;dbl+lbl&gt;, int058 &lt;dbl+lbl&gt;,
## #   int059 &lt;dbl+lbl&gt;, int059a &lt;dbl+lbl&gt;, var571 &lt;dbl+lbl&gt;, var572 &lt;dbl+lbl&gt;, var573 &lt;dbl+lbl&gt;,
## #   var574 &lt;dbl+lbl&gt;, var576 &lt;dbl+lbl&gt;, var153 &lt;dbl+lbl&gt;, var154 &lt;dbl+lbl&gt;, var155 &lt;dbl+lbl&gt;,
## #   var156 &lt;dbl+lbl&gt;, var157 &lt;dbl+lbl&gt;, var157a &lt;dbl+lbl&gt;, var154a &lt;dbl+lbl&gt;, var164 &lt;dbl+lbl&gt;,
## #   var165 &lt;dbl+lbl&gt;, var166 &lt;dbl+lbl&gt;, var179 &lt;dbl+lbl&gt;, var180 &lt;dbl+lbl&gt;, var184 &lt;dbl+lbl&gt;,
## #   var185 &lt;dbl+lbl&gt;, var198a &lt;dbl+lbl&gt;, var198 &lt;dbl+lbl&gt;, var201a &lt;dbl+lbl&gt;, var201b &lt;dbl+lbl&gt;,
## #   var204 &lt;dbl+lbl&gt;, int257 &lt;dbl+lbl&gt;, var211 &lt;dbl+lbl&gt;, var223 &lt;dbl+lbl&gt;, var1320 &lt;dbl+lbl&gt;,
## #   var1321 &lt;dbl+lbl&gt;, var1322 &lt;dbl+lbl&gt;, var1323 &lt;dbl+lbl&gt;, var1324 &lt;dbl+lbl&gt;, var1325 &lt;dbl+lbl&gt;,
## #   var1326 &lt;dbl+lbl&gt;, var1327 &lt;dbl+lbl&gt;, var1328 &lt;dbl+lbl&gt;, var229 &lt;dbl+lbl&gt;, int218 &lt;dbl+lbl&gt;,
## #   int219 &lt;dbl+lbl&gt;, int221 &lt;dbl+lbl&gt;, int222 &lt;dbl+lbl&gt;, int223 &lt;dbl+lbl&gt;, int710 &lt;dbl+lbl&gt;,
## #   int711 &lt;dbl+lbl&gt;, int712 &lt;dbl+lbl&gt;, int713 &lt;dbl+lbl&gt;, int714 &lt;dbl+lbl&gt;, int715 &lt;dbl+lbl&gt;,
## #   int716 &lt;dbl+lbl&gt;, var433 &lt;dbl+lbl&gt;, var439 &lt;dbl+lbl&gt;, var1329 &lt;dbl+lbl&gt;, var1330 &lt;dbl+lbl&gt;,
## #   var445 &lt;dbl+lbl&gt;, var446 &lt;dbl+lbl&gt;, var447 &lt;dbl+lbl&gt;, var451 &lt;dbl+lbl&gt;, var452 &lt;dbl+lbl&gt;,
## #   var1316 &lt;dbl+lbl&gt;, var1317 &lt;dbl+lbl&gt;, var1331 &lt;dbl+lbl&gt;, vw065 &lt;dbl+lbl&gt;, var491 &lt;dbl+lbl&gt;,
## #   var040 &lt;dbl+lbl&gt;, var1304 &lt;dbl+lbl&gt;, var274 &lt;dbl+lbl&gt;, var275 &lt;dbl+lbl&gt;, var1196 &lt;dbl+lbl&gt;,
## #   var1197 &lt;dbl+lbl&gt;, var461 &lt;dbl+lbl&gt;, var273 &lt;dbl+lbl&gt;, var1262 &lt;dbl+lbl&gt;, ...</code></pre>
<blockquote>
<p>So what are you adding to your cheat sheet? <code>rowwise()</code>, <code>select()</code>.</p>
</blockquote>
</div>
</div>
<div id="merging-data-files" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Merging data files</h2>
<p>What you need to know 1: Panel or stacked cross-sections?<br />
What you need to know 2: If panel, do you want data in long or wide format?</p>
<p>We need to follow these steps:</p>
<ul>
<li>Step1: select variables</li>
<li>Step2: make consistent</li>
<li>Step3: perform the actual merging. Make sure to include necessary identifier variables.</li>
<li>Step4: check your results!!</li>
</ul>
<div id="r-base-3" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> R Base</h3>
<div id="step1-select-variables" class="section level4" number="8.4.1.1">
<h4><span class="header-section-number">8.4.1.1</span> Step1: select variables</h4>
<div class="sourceCode" id="cb153"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb153-1"><a href="data-manipulations.html#cb153-1"></a><span class="co">#step 1: selecting the variables you want to keep.</span></span>
<span id="cb153-2"><a href="data-manipulations.html#cb153-2"></a><span class="co">#for this tutorial only 6 variables: id, age, sex, educ, health, region (not that R is case sensitive)</span></span>
<span id="cb153-3"><a href="data-manipulations.html#cb153-3"></a>cv08_sel <span class="ot">&lt;-</span> cv08[,<span class="fu">c</span>(<span class="st">&quot;we_id&quot;</span>, <span class="st">&quot;lftop&quot;</span>, <span class="st">&quot;geslacht&quot;</span>, <span class="st">&quot;var006n&quot;</span>, <span class="st">&quot;v401&quot;</span>, <span class="st">&quot;landd&quot;</span>)]</span>
<span id="cb153-4"><a href="data-manipulations.html#cb153-4"></a>cv10_sel <span class="ot">&lt;-</span> cv10[,<span class="fu">c</span>(<span class="st">&quot;Sleutel&quot;</span>, <span class="st">&quot;var002&quot;</span>, <span class="st">&quot;var001&quot;</span>, <span class="st">&quot;Vltoplop&quot;</span>, <span class="st">&quot;V401&quot;</span>, <span class="st">&quot;Landd&quot;</span>)]</span></code></pre></div>
<blockquote>
<p>Note that to select rows, you need to set an expression before the “,” [row,] and to select columns, after the “,” [,col]. Thus with <code>dataset[i,j]</code> you will select row <em>i</em> and column <em>j</em>. You have learned to subset dataframes by using indici (e.g. <code>dataset[,1:3]</code>), logical expressions (e.g. <code>dataset[var1&gt;1,])</code>, and names (e.g. <code>dataset[,varname]</code>).</p>
</blockquote>
</div>
<div id="step2-make-consistent" class="section level4" number="8.4.1.2">
<h4><span class="header-section-number">8.4.1.2</span> Step2: make consistent</h4>
<div class="sourceCode" id="cb154"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb154-1"><a href="data-manipulations.html#cb154-1"></a><span class="co">#step 2: making the variables similar across individual datasets</span></span>
<span id="cb154-2"><a href="data-manipulations.html#cb154-2"></a><span class="co">#step 2a: making names the same</span></span>
<span id="cb154-3"><a href="data-manipulations.html#cb154-3"></a><span class="fu">names</span>(cv08_sel) <span class="ot">&lt;-</span> <span class="fu">names</span>(cv10_sel) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;health&quot;</span>, <span class="st">&quot;region&quot;</span>)</span>
<span id="cb154-4"><a href="data-manipulations.html#cb154-4"></a></span>
<span id="cb154-5"><a href="data-manipulations.html#cb154-5"></a><span class="co">#step 2b: making levels and labels consistent</span></span>
<span id="cb154-6"><a href="data-manipulations.html#cb154-6"></a><span class="fu">summary</span>(cv08_sel)</span>
<span id="cb154-7"><a href="data-manipulations.html#cb154-7"></a><span class="fu">summary</span>(cv10_sel)</span>
<span id="cb154-8"><a href="data-manipulations.html#cb154-8"></a><span class="co">#they look very consistent already. but check carefully. </span></span>
<span id="cb154-9"><a href="data-manipulations.html#cb154-9"></a></span>
<span id="cb154-10"><a href="data-manipulations.html#cb154-10"></a><span class="co">#we don&#39;t want id to be a factor but numeric. Note that we don&#39;t want the factor level values as numbers but the actual labels as numbers. </span></span>
<span id="cb154-11"><a href="data-manipulations.html#cb154-11"></a></span>
<span id="cb154-12"><a href="data-manipulations.html#cb154-12"></a><span class="co">#id</span></span>
<span id="cb154-13"><a href="data-manipulations.html#cb154-13"></a>cv08_sel<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(cv08_sel<span class="sc">$</span>id))</span>
<span id="cb154-14"><a href="data-manipulations.html#cb154-14"></a>cv10_sel<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(cv10_sel<span class="sc">$</span>id))</span>
<span id="cb154-15"><a href="data-manipulations.html#cb154-15"></a></span>
<span id="cb154-16"><a href="data-manipulations.html#cb154-16"></a><span class="co">#age</span></span>
<span id="cb154-17"><a href="data-manipulations.html#cb154-17"></a>cv08_sel<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(cv08_sel<span class="sc">$</span>age))</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb156-1"><a href="data-manipulations.html#cb156-1"></a>cv10_sel<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(cv10_sel<span class="sc">$</span>age))</span>
<span id="cb156-2"><a href="data-manipulations.html#cb156-2"></a></span>
<span id="cb156-3"><a href="data-manipulations.html#cb156-3"></a><span class="co">#sex men</span></span>
<span id="cb156-4"><a href="data-manipulations.html#cb156-4"></a><span class="fu">levels</span>(cv08_sel<span class="sc">$</span>sex)</span>
<span id="cb156-5"><a href="data-manipulations.html#cb156-5"></a><span class="fu">levels</span>(cv10_sel<span class="sc">$</span>sex)</span>
<span id="cb156-6"><a href="data-manipulations.html#cb156-6"></a><span class="fu">table</span>(cv08_sel<span class="sc">$</span>sex, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-7"><a href="data-manipulations.html#cb156-7"></a><span class="fu">table</span>(cv10_sel<span class="sc">$</span>sex, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-8"><a href="data-manipulations.html#cb156-8"></a><span class="co">#lets make it a numeric var first</span></span>
<span id="cb156-9"><a href="data-manipulations.html#cb156-9"></a>cv08_sel<span class="sc">$</span>sexn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv08_sel<span class="sc">$</span>sex)</span>
<span id="cb156-10"><a href="data-manipulations.html#cb156-10"></a><span class="fu">table</span>(cv08_sel<span class="sc">$</span>sexn)</span>
<span id="cb156-11"><a href="data-manipulations.html#cb156-11"></a><span class="co">#recode into dummy</span></span>
<span id="cb156-12"><a href="data-manipulations.html#cb156-12"></a>cv08_sel<span class="sc">$</span>men <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(cv08_sel<span class="sc">$</span>sexn<span class="sc">==</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb156-13"><a href="data-manipulations.html#cb156-13"></a>cv08_sel<span class="sc">$</span>men <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(cv08_sel<span class="sc">$</span>sexn<span class="sc">==</span><span class="dv">1</span>, <span class="cn">NA</span>, cv08_sel<span class="sc">$</span>men)</span>
<span id="cb156-14"><a href="data-manipulations.html#cb156-14"></a><span class="co">#check</span></span>
<span id="cb156-15"><a href="data-manipulations.html#cb156-15"></a><span class="fu">table</span>(cv08_sel<span class="sc">$</span>men, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-16"><a href="data-manipulations.html#cb156-16"></a><span class="co">#lets make it a numeric var first</span></span>
<span id="cb156-17"><a href="data-manipulations.html#cb156-17"></a>cv10_sel<span class="sc">$</span>sexn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv10_sel<span class="sc">$</span>sex)</span>
<span id="cb156-18"><a href="data-manipulations.html#cb156-18"></a><span class="fu">table</span>(cv10_sel<span class="sc">$</span>sexn)</span>
<span id="cb156-19"><a href="data-manipulations.html#cb156-19"></a><span class="co">#recode into dummy</span></span>
<span id="cb156-20"><a href="data-manipulations.html#cb156-20"></a>cv10_sel<span class="sc">$</span>men <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(cv10_sel<span class="sc">$</span>sexn<span class="sc">==</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb156-21"><a href="data-manipulations.html#cb156-21"></a><span class="co">#check</span></span>
<span id="cb156-22"><a href="data-manipulations.html#cb156-22"></a><span class="fu">table</span>(cv10_sel<span class="sc">$</span>men, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-23"><a href="data-manipulations.html#cb156-23"></a></span>
<span id="cb156-24"><a href="data-manipulations.html#cb156-24"></a><span class="co">#educ educ3</span></span>
<span id="cb156-25"><a href="data-manipulations.html#cb156-25"></a><span class="fu">levels</span>(cv08_sel<span class="sc">$</span>educ)</span>
<span id="cb156-26"><a href="data-manipulations.html#cb156-26"></a><span class="fu">levels</span>(cv10_sel<span class="sc">$</span>educ)</span>
<span id="cb156-27"><a href="data-manipulations.html#cb156-27"></a><span class="fu">table</span>(cv08_sel<span class="sc">$</span>educ, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-28"><a href="data-manipulations.html#cb156-28"></a><span class="fu">table</span>(cv10_sel<span class="sc">$</span>educ, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-29"><a href="data-manipulations.html#cb156-29"></a><span class="co">#lets make it a numeric var first</span></span>
<span id="cb156-30"><a href="data-manipulations.html#cb156-30"></a>cv08_sel<span class="sc">$</span>educn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv08_sel<span class="sc">$</span>educ)</span>
<span id="cb156-31"><a href="data-manipulations.html#cb156-31"></a><span class="fu">table</span>(cv08_sel<span class="sc">$</span>educn)</span>
<span id="cb156-32"><a href="data-manipulations.html#cb156-32"></a><span class="co">#recode into 3cats: 1 primair, 2 secundair, 3 is tertiair</span></span>
<span id="cb156-33"><a href="data-manipulations.html#cb156-33"></a>cv08_sel<span class="sc">$</span>educ3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb156-34"><a href="data-manipulations.html#cb156-34"></a>cv08_sel<span class="sc">$</span>educ3[cv08_sel<span class="sc">$</span>educn<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> cv08_sel<span class="sc">$</span>educn<span class="sc">==</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb156-35"><a href="data-manipulations.html#cb156-35"></a>cv08_sel<span class="sc">$</span>educ3[cv08_sel<span class="sc">$</span>educn<span class="sc">&gt;</span><span class="dv">3</span> <span class="sc">&amp;</span> cv08_sel<span class="sc">$</span>educn<span class="sc">&lt;</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb156-36"><a href="data-manipulations.html#cb156-36"></a>cv08_sel<span class="sc">$</span>educ3[cv08_sel<span class="sc">$</span>educn<span class="sc">&gt;</span><span class="dv">7</span> <span class="sc">&amp;</span> cv08_sel<span class="sc">$</span>educn<span class="sc">&lt;</span><span class="dv">11</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb156-37"><a href="data-manipulations.html#cb156-37"></a><span class="co">#check</span></span>
<span id="cb156-38"><a href="data-manipulations.html#cb156-38"></a><span class="fu">table</span>(cv08_sel<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-39"><a href="data-manipulations.html#cb156-39"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(cv08_sel<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>))</span>
<span id="cb156-40"><a href="data-manipulations.html#cb156-40"></a></span>
<span id="cb156-41"><a href="data-manipulations.html#cb156-41"></a><span class="co">#lets make it a numeric var first</span></span>
<span id="cb156-42"><a href="data-manipulations.html#cb156-42"></a>cv10_sel<span class="sc">$</span>educn <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cv10_sel<span class="sc">$</span>educ)</span>
<span id="cb156-43"><a href="data-manipulations.html#cb156-43"></a><span class="fu">table</span>(cv10_sel<span class="sc">$</span>educn)</span>
<span id="cb156-44"><a href="data-manipulations.html#cb156-44"></a><span class="co">#recode into 3cats: 1 primair, 2 secundari, 3 is tertiair</span></span>
<span id="cb156-45"><a href="data-manipulations.html#cb156-45"></a>cv10_sel<span class="sc">$</span>educ3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb156-46"><a href="data-manipulations.html#cb156-46"></a>cv10_sel<span class="sc">$</span>educ3[cv10_sel<span class="sc">$</span>educn<span class="sc">&lt;</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#correct?</span></span>
<span id="cb156-47"><a href="data-manipulations.html#cb156-47"></a>cv10_sel<span class="sc">$</span>educ3[cv10_sel<span class="sc">$</span>educn<span class="sc">&gt;</span><span class="dv">2</span> <span class="sc">&amp;</span> cv10_sel<span class="sc">$</span>educn<span class="sc">&lt;</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb156-48"><a href="data-manipulations.html#cb156-48"></a>cv10_sel<span class="sc">$</span>educ3[cv10_sel<span class="sc">$</span>educn<span class="sc">==</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb156-49"><a href="data-manipulations.html#cb156-49"></a><span class="co">#check</span></span>
<span id="cb156-50"><a href="data-manipulations.html#cb156-50"></a><span class="fu">table</span>(cv10_sel<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>)</span>
<span id="cb156-51"><a href="data-manipulations.html#cb156-51"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(cv10_sel<span class="sc">$</span>educ3, <span class="at">useNA=</span><span class="st">&quot;always&quot;</span>))</span></code></pre></div>
</div>
<div id="step3-merge" class="section level4" number="8.4.1.3">
<h4><span class="header-section-number">8.4.1.3</span> Step3: merge</h4>
<div class="sourceCode" id="cb157"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb157-1"><a href="data-manipulations.html#cb157-1"></a><span class="co">#lets add a wave variable</span></span>
<span id="cb157-2"><a href="data-manipulations.html#cb157-2"></a>cv08_sel<span class="sc">$</span>wave <span class="ot">&lt;-</span> <span class="dv">2008</span></span>
<span id="cb157-3"><a href="data-manipulations.html#cb157-3"></a>cv10_sel<span class="sc">$</span>wave <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb157-4"><a href="data-manipulations.html#cb157-4"></a></span>
<span id="cb157-5"><a href="data-manipulations.html#cb157-5"></a><span class="co">#let make a fake ID, we will use this later when we pretend CV is panel data. </span></span>
<span id="cb157-6"><a href="data-manipulations.html#cb157-6"></a>cv08_sel<span class="sc">$</span>id2 <span class="ot">&lt;-</span> <span class="fu">rank</span>(cv08_sel<span class="sc">$</span>id)</span>
<span id="cb157-7"><a href="data-manipulations.html#cb157-7"></a>cv10_sel<span class="sc">$</span>id2 <span class="ot">&lt;-</span> <span class="fu">rank</span>(cv10_sel<span class="sc">$</span>id)</span>
<span id="cb157-8"><a href="data-manipulations.html#cb157-8"></a></span>
<span id="cb157-9"><a href="data-manipulations.html#cb157-9"></a><span class="co">#simply place one dataset under the other thus row bind (rbind)</span></span>
<span id="cb157-10"><a href="data-manipulations.html#cb157-10"></a><span class="co">#check first if same vars in both datasets.</span></span>
<span id="cb157-11"><a href="data-manipulations.html#cb157-11"></a><span class="co">#perhaps clean up first. </span></span>
<span id="cb157-12"><a href="data-manipulations.html#cb157-12"></a></span>
<span id="cb157-13"><a href="data-manipulations.html#cb157-13"></a>cv08_sel <span class="ot">&lt;-</span> cv08_sel[,<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>,<span class="st">&quot;id2&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;men&quot;</span>, <span class="st">&quot;educ3&quot;</span>, <span class="st">&quot;health&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;wave&quot;</span>)]</span>
<span id="cb157-14"><a href="data-manipulations.html#cb157-14"></a>cv10_sel <span class="ot">&lt;-</span> cv10_sel[,<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;id2&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;men&quot;</span>, <span class="st">&quot;educ3&quot;</span>, <span class="st">&quot;health&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;wave&quot;</span>)]</span>
<span id="cb157-15"><a href="data-manipulations.html#cb157-15"></a></span>
<span id="cb157-16"><a href="data-manipulations.html#cb157-16"></a><span class="fu">summary</span>(cv08_sel)</span></code></pre></div>
<pre><code>##        id                id2              age             men           educ3      
##  Min.   :36775330   Min.   :   1.0   Min.   :16.00   Min.   :0.00   Min.   :1.000  
##  1st Qu.:37604540   1st Qu.: 491.5   1st Qu.:33.00   1st Qu.:0.00   1st Qu.:2.000  
##  Median :38724230   Median : 982.0   Median :46.00   Median :1.00   Median :2.000  
##  Mean   :38830177   Mean   : 982.0   Mean   :46.67   Mean   :0.51   Mean   :2.064  
##  3rd Qu.:40598965   3rd Qu.:1472.5   3rd Qu.:60.00   3rd Qu.:1.00   3rd Qu.:3.000  
##  Max.   :41199300   Max.   :1963.0   Max.   :91.00   Max.   :1.00   Max.   :3.000  
##                                      NA&#39;s   :4       NA&#39;s   :10     NA&#39;s   :5      
##              health                         region         wave     
##  goed,          :1060   Postcode (nog) onbekend:  0   Min.   :2008  
##  zeer goed,     : 504   Noord-Nederland        :220   1st Qu.:2008  
##  gaat wel,      : 320   Oost-Nederland         :416   Median :2008  
##  slecht,        :  67   West-Nederland         :853   Mean   :2008  
##  of zeer slecht?:  12   Zuid-Nederland         :474   3rd Qu.:2008  
##  Geen opgave    :   0                                 Max.   :2008  
##  (Other)        :   0</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb159-1"><a href="data-manipulations.html#cb159-1"></a><span class="fu">summary</span>(cv10_sel)</span></code></pre></div>
<pre><code>##        id                id2              age             men            educ3      
##  Min.   :20131231   Min.   :   1.0   Min.   :16.00   Min.   :0.000   Min.   :1.000  
##  1st Qu.:20131965   1st Qu.: 734.8   1st Qu.:34.00   1st Qu.:0.000   1st Qu.:2.000  
##  Median :20132698   Median :1468.5   Median :48.00   Median :0.000   Median :2.000  
##  Mean   :20132698   Mean   :1468.5   Mean   :48.27   Mean   :0.485   Mean   :2.106  
##  3rd Qu.:20133432   3rd Qu.:2202.2   3rd Qu.:63.00   3rd Qu.:1.000   3rd Qu.:3.000  
##  Max.   :20134166   Max.   :2936.0   Max.   :96.00   Max.   :1.000   Max.   :3.000  
##                                                                      NA&#39;s   :3      
##              health                 region          wave     
##  goed,          :1592   Noord-Nederland: 306   Min.   :2010  
##  zeer goed,     : 776   Oost-Nederland : 678   1st Qu.:2010  
##  gaat wel,      : 466   West-Nederland :1263   Median :2010  
##  slecht,        :  79   Zuid-Nederland : 689   Mean   :2010  
##  of zeer slecht?:  22                          3rd Qu.:2010  
##  Weigert        :   1                          Max.   :2010  
##  (Other)        :   0</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb161-1"><a href="data-manipulations.html#cb161-1"></a>cv_tot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cv08_sel, cv10_sel)</span></code></pre></div>
</div>
<div id="step4-check" class="section level4" number="8.4.1.4">
<h4><span class="header-section-number">8.4.1.4</span> Step4: check</h4>
<div class="sourceCode" id="cb162"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb162-1"><a href="data-manipulations.html#cb162-1"></a><span class="fu">summary</span>(cv_tot)</span></code></pre></div>
<pre><code>##        id                id2            age             men            educ3      
##  Min.   :20131231   Min.   :   1   Min.   :16.00   Min.   :0.000   Min.   :1.000  
##  1st Qu.:20132456   1st Qu.: 613   1st Qu.:33.00   1st Qu.:0.000   1st Qu.:2.000  
##  Median :20133680   Median :1225   Median :47.00   Median :0.000   Median :2.000  
##  Mean   :27624666   Mean   :1274   Mean   :47.63   Mean   :0.495   Mean   :2.089  
##  3rd Qu.:37978375   3rd Qu.:1838   3rd Qu.:62.00   3rd Qu.:1.000   3rd Qu.:3.000  
##  Max.   :41199300   Max.   :2936   Max.   :96.00   Max.   :1.000   Max.   :3.000  
##                                    NA&#39;s   :4       NA&#39;s   :10      NA&#39;s   :8      
##              health                         region          wave     
##  goed,          :2652   Postcode (nog) onbekend:   0   Min.   :2008  
##  zeer goed,     :1280   Noord-Nederland        : 526   1st Qu.:2008  
##  gaat wel,      : 786   Oost-Nederland         :1094   Median :2010  
##  slecht,        : 146   West-Nederland         :2116   Mean   :2009  
##  of zeer slecht?:  34   Zuid-Nederland         :1163   3rd Qu.:2010  
##  Weigert        :   1                                  Max.   :2010  
##  (Other)        :   0</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb164-1"><a href="data-manipulations.html#cb164-1"></a><span class="fu">head</span>(cv_tot)</span></code></pre></div>
<pre><code>##         id id2 age men educ3    health         region wave
## 1 36775330   1  51   1     3     goed, West-Nederland 2008
## 2 36775340   2  39   0     3     goed, West-Nederland 2008
## 3 36775420   3  16   0     2     goed, West-Nederland 2008
## 4 36775440   4  29   1     3     goed, West-Nederland 2008
## 5 36775450   5  57   1     3 gaat wel, West-Nederland 2008
## 6 36775460   6  49   0     2     goed, West-Nederland 2008</code></pre>
<p>Okay, lets pretend it was panel data. <code>cv_tot</code> would then be a panel dataset in long format. But oftentimes, you want a panel dataset in wide format.<br />
If you don’t know the difference between long and wide format, check the differences between <code>cv_tot</code> and <code>cv_tot_panel</code> after step3b.</p>
</div>
<div id="step3b-merge" class="section level4" number="8.4.1.5">
<h4><span class="header-section-number">8.4.1.5</span> Step3b: merge</h4>
<div class="sourceCode" id="cb166"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb166-1"><a href="data-manipulations.html#cb166-1"></a><span class="co">#lets make a panel dataset in wide format</span></span>
<span id="cb166-2"><a href="data-manipulations.html#cb166-2"></a>cv_tot_panel <span class="ot">&lt;-</span> <span class="fu">merge</span>(cv08_sel, cv10_sel, <span class="at">all=</span><span class="cn">TRUE</span>, <span class="at">by=</span><span class="st">&quot;id2&quot;</span>)</span>
<span id="cb166-3"><a href="data-manipulations.html#cb166-3"></a><span class="fu">head</span>(cv_tot_panel)</span></code></pre></div>
<pre><code>##   id2     id.x age.x men.x educ3.x  health.x       region.x wave.x     id.y age.y men.y educ3.y
## 1   1 36775330    51     1       3     goed, West-Nederland   2008 20131231    20     0       2
## 2   2 36775340    39     0       3     goed, West-Nederland   2008 20131232    29     0       3
## 3   3 36775420    16     0       2     goed, West-Nederland   2008 20131233    30     1       2
## 4   4 36775440    29     1       3     goed, West-Nederland   2008 20131234    64     1       2
## 5   5 36775450    57     1       3 gaat wel, West-Nederland   2008 20131235    45     1       1
## 6   6 36775460    49     0       2     goed, West-Nederland   2008 20131236    80     0       2
##     health.y       region.y wave.y
## 1      goed, West-Nederland   2010
## 2 zeer goed, West-Nederland   2010
## 3      goed, West-Nederland   2010
## 4      goed, West-Nederland   2010
## 5      goed, West-Nederland   2010
## 6      goed, West-Nederland   2010</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb168-1"><a href="data-manipulations.html#cb168-1"></a><span class="co">#rename variables. and when necessary merge again with third wave. not very efficient but it works.</span></span>
<span id="cb168-2"><a href="data-manipulations.html#cb168-2"></a></span>
<span id="cb168-3"><a href="data-manipulations.html#cb168-3"></a><span class="co">#many people prefer the reshape function. (i like doing it myself but here it goes)</span></span>
<span id="cb168-4"><a href="data-manipulations.html#cb168-4"></a>?reshape</span></code></pre></div>
<pre><code>## starting httpd help server ... done</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb170-1"><a href="data-manipulations.html#cb170-1"></a>cv_tot_panel <span class="ot">&lt;-</span> <span class="fu">reshape</span>(cv_tot, <span class="at">timevar=</span><span class="st">&quot;wave&quot;</span>, <span class="at">idvar=</span><span class="st">&quot;id2&quot;</span>, <span class="at">direction=</span><span class="st">&quot;wide&quot;</span>)</span>
<span id="cb170-2"><a href="data-manipulations.html#cb170-2"></a><span class="fu">head</span>(cv_tot_panel)</span></code></pre></div>
<pre><code>##   id2  id.2008 age.2008 men.2008 educ3.2008 health.2008    region.2008  id.2010 age.2010 men.2010
## 1   1 36775330       51        1          3       goed, West-Nederland 20131231       20        0
## 2   2 36775340       39        0          3       goed, West-Nederland 20131232       29        0
## 3   3 36775420       16        0          2       goed, West-Nederland 20131233       30        1
## 4   4 36775440       29        1          3       goed, West-Nederland 20131234       64        1
## 5   5 36775450       57        1          3   gaat wel, West-Nederland 20131235       45        1
## 6   6 36775460       49        0          2       goed, West-Nederland 20131236       80        0
##   educ3.2010 health.2010    region.2010
## 1          2       goed, West-Nederland
## 2          3  zeer goed, West-Nederland
## 3          2       goed, West-Nederland
## 4          2       goed, West-Nederland
## 5          1       goed, West-Nederland
## 6          2       goed, West-Nederland</code></pre>
</div>
</div>
<div id="tidy-3" class="section level3" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Tidy</h3>
<div id="step1-select-variables-1" class="section level4" number="8.4.2.1">
<h4><span class="header-section-number">8.4.2.1</span> Step1: select variables</h4>
<div class="sourceCode" id="cb172"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb172-1"><a href="data-manipulations.html#cb172-1"></a><span class="co">#step 1: selecting the variables you want to keep.</span></span>
<span id="cb172-2"><a href="data-manipulations.html#cb172-2"></a><span class="co">#for this tutorial only 6 variables: id, age, sex, educ, health, region (not that R is case sensitive)</span></span>
<span id="cb172-3"><a href="data-manipulations.html#cb172-3"></a>cv08_sel <span class="ot">&lt;-</span> cv08_haven <span class="sc">%&gt;%</span></span>
<span id="cb172-4"><a href="data-manipulations.html#cb172-4"></a>    <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;we_id&quot;</span>, <span class="st">&quot;lftop&quot;</span>, <span class="st">&quot;geslacht&quot;</span>, <span class="st">&quot;var006n&quot;</span>, <span class="st">&quot;v401&quot;</span>, <span class="st">&quot;landd&quot;</span>)) </span>
<span id="cb172-5"><a href="data-manipulations.html#cb172-5"></a></span>
<span id="cb172-6"><a href="data-manipulations.html#cb172-6"></a>cv10_sel <span class="ot">&lt;-</span> cv10_haven <span class="sc">%&gt;%</span></span>
<span id="cb172-7"><a href="data-manipulations.html#cb172-7"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;Sleutel&quot;</span>, <span class="st">&quot;var002&quot;</span>, <span class="st">&quot;var001&quot;</span>, <span class="st">&quot;Vltoplop&quot;</span>, <span class="st">&quot;V401&quot;</span>, <span class="st">&quot;Landd&quot;</span>))</span></code></pre></div>
</div>
<div id="step2-make-consistent-1" class="section level4" number="8.4.2.2">
<h4><span class="header-section-number">8.4.2.2</span> Step2: make consistent</h4>
<div class="sourceCode" id="cb173"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb173-1"><a href="data-manipulations.html#cb173-1"></a><span class="co">#step 2: making the variables similar across individual datasets</span></span>
<span id="cb173-2"><a href="data-manipulations.html#cb173-2"></a><span class="co">#step 2a: making names the same</span></span>
<span id="cb173-3"><a href="data-manipulations.html#cb173-3"></a><span class="fu">names</span>(cv08_sel) <span class="ot">&lt;-</span> <span class="fu">names</span>(cv10_sel) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;health&quot;</span>, <span class="st">&quot;region&quot;</span>)</span>
<span id="cb173-4"><a href="data-manipulations.html#cb173-4"></a></span>
<span id="cb173-5"><a href="data-manipulations.html#cb173-5"></a><span class="co">#step 2b: making levels and labels consistent</span></span>
<span id="cb173-6"><a href="data-manipulations.html#cb173-6"></a><span class="fu">str</span>(cv08_sel)</span>
<span id="cb173-7"><a href="data-manipulations.html#cb173-7"></a><span class="fu">str</span>(cv10_sel)</span>
<span id="cb173-8"><a href="data-manipulations.html#cb173-8"></a></span>
<span id="cb173-9"><a href="data-manipulations.html#cb173-9"></a><span class="co">#summary(cv08_sel)</span></span>
<span id="cb173-10"><a href="data-manipulations.html#cb173-10"></a><span class="co">#summary(cv10_sel)</span></span>
<span id="cb173-11"><a href="data-manipulations.html#cb173-11"></a></span>
<span id="cb173-12"><a href="data-manipulations.html#cb173-12"></a><span class="co">#they look very consistent already. but check carefully. </span></span>
<span id="cb173-13"><a href="data-manipulations.html#cb173-13"></a><span class="co">#id is okay</span></span>
<span id="cb173-14"><a href="data-manipulations.html#cb173-14"></a></span>
<span id="cb173-15"><a href="data-manipulations.html#cb173-15"></a><span class="co">#age: replace &#39;onbekend&#39;</span></span>
<span id="cb173-16"><a href="data-manipulations.html#cb173-16"></a>cv08_sel <span class="ot">&lt;-</span> cv08_sel <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">age=</span><span class="fu">na_if</span>(age, <span class="dv">99</span>))</span>
<span id="cb173-17"><a href="data-manipulations.html#cb173-17"></a>cv10_sel <span class="ot">&lt;-</span> cv10_sel <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">age=</span><span class="fu">na_if</span>(age, <span class="dv">99</span>))</span>
<span id="cb173-18"><a href="data-manipulations.html#cb173-18"></a></span>
<span id="cb173-19"><a href="data-manipulations.html#cb173-19"></a><span class="co">#sex: men</span></span>
<span id="cb173-20"><a href="data-manipulations.html#cb173-20"></a>cv08_sel <span class="ot">&lt;-</span> cv08_sel <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">men=</span><span class="fu">recode</span>(sex, <span class="st">&#39;9&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;M&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;V&#39;</span><span class="ot">=</span><span class="dv">0</span>, <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>),</span>
<span id="cb173-21"><a href="data-manipulations.html#cb173-21"></a>                                <span class="at">men=</span><span class="fu">na_if</span>(men,<span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb173-22"><a href="data-manipulations.html#cb173-22"></a>                                <span class="at">men=</span><span class="fu">labelled</span>(men, <span class="fu">c</span>(<span class="st">&quot;man&quot;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&quot;vrouw&quot;</span><span class="ot">=</span><span class="dv">0</span>)))</span>
<span id="cb173-23"><a href="data-manipulations.html#cb173-23"></a>cv10_sel <span class="ot">&lt;-</span> cv10_sel <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">men=</span><span class="fu">recode</span>(sex, <span class="st">&#39;2&#39;</span><span class="ot">=</span><span class="dv">0</span>, <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>),</span>
<span id="cb173-24"><a href="data-manipulations.html#cb173-24"></a>                                <span class="at">men=</span><span class="fu">labelled</span>(men, <span class="fu">c</span>(<span class="st">&quot;man&quot;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&quot;vrouw&quot;</span><span class="ot">=</span><span class="dv">0</span>)))</span>
<span id="cb173-25"><a href="data-manipulations.html#cb173-25"></a></span>
<span id="cb173-26"><a href="data-manipulations.html#cb173-26"></a><span class="co">#educ educ3</span></span>
<span id="cb173-27"><a href="data-manipulations.html#cb173-27"></a><span class="fu">attr</span>(cv08_sel<span class="sc">$</span>educ, <span class="st">&quot;labels&quot;</span>)</span>
<span id="cb173-28"><a href="data-manipulations.html#cb173-28"></a><span class="fu">attr</span>(cv10_sel<span class="sc">$</span>educ, <span class="st">&quot;labels&quot;</span>)</span>
<span id="cb173-29"><a href="data-manipulations.html#cb173-29"></a></span>
<span id="cb173-30"><a href="data-manipulations.html#cb173-30"></a>cv08_sel <span class="ot">&lt;-</span> cv08_sel <span class="sc">%&gt;%</span> </span>
<span id="cb173-31"><a href="data-manipulations.html#cb173-31"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">recode</span>(educ, <span class="st">&#39;-3&#39;</span><span class="ot">=</span><span class="sc">-</span><span class="dv">9</span>, <span class="st">&#39;-1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">2</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;5&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;6&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;7&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;8&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;10&#39;</span><span class="ot">=</span> <span class="sc">-</span><span class="dv">9</span>, <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>),   </span>
<span id="cb173-32"><a href="data-manipulations.html#cb173-32"></a>    <span class="at">educ3=</span><span class="fu">na_if</span>(educ3, <span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb173-33"><a href="data-manipulations.html#cb173-33"></a>    <span class="at">educ3=</span><span class="fu">factor</span>(educ3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)))</span>
<span id="cb173-34"><a href="data-manipulations.html#cb173-34"></a></span>
<span id="cb173-35"><a href="data-manipulations.html#cb173-35"></a>cv10_sel <span class="ot">&lt;-</span> cv10_sel <span class="sc">%&gt;%</span> </span>
<span id="cb173-36"><a href="data-manipulations.html#cb173-36"></a>  <span class="fu">mutate</span>(<span class="at">educ3=</span><span class="fu">recode</span>(educ, <span class="st">&#39;-1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">&#39;2&#39;</span><span class="ot">=</span> <span class="dv">2</span> , <span class="st">&#39;3&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;4&#39;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&#39;5&#39;</span><span class="ot">=</span> <span class="dv">3</span>, <span class="st">&#39;10&#39;</span><span class="ot">=</span> <span class="sc">-</span><span class="dv">9</span>, <span class="at">.keep_value_labels =</span> <span class="cn">FALSE</span>),   </span>
<span id="cb173-37"><a href="data-manipulations.html#cb173-37"></a>    <span class="at">educ3=</span><span class="fu">na_if</span>(educ3, <span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb173-38"><a href="data-manipulations.html#cb173-38"></a>    <span class="at">educ3=</span><span class="fu">factor</span>(educ3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;primary&quot;</span>, <span class="st">&quot;secondary&quot;</span>, <span class="st">&quot;tertiary&quot;</span>)))</span></code></pre></div>
</div>
<div id="step3-merge-1" class="section level4" number="8.4.2.3">
<h4><span class="header-section-number">8.4.2.3</span> Step3: merge</h4>
<div class="sourceCode" id="cb174"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb174-1"><a href="data-manipulations.html#cb174-1"></a><span class="co">#lets add a wave variable</span></span>
<span id="cb174-2"><a href="data-manipulations.html#cb174-2"></a>cv08_sel<span class="sc">$</span>wave <span class="ot">&lt;-</span> <span class="dv">2008</span></span>
<span id="cb174-3"><a href="data-manipulations.html#cb174-3"></a>cv10_sel<span class="sc">$</span>wave <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb174-4"><a href="data-manipulations.html#cb174-4"></a></span>
<span id="cb174-5"><a href="data-manipulations.html#cb174-5"></a><span class="co">#let make a fake ID, we will use this later when we pretend CV is panel data. </span></span>
<span id="cb174-6"><a href="data-manipulations.html#cb174-6"></a>cv08_sel<span class="sc">$</span>id2 <span class="ot">&lt;-</span> <span class="fu">rank</span>(cv08_sel<span class="sc">$</span>id)</span>
<span id="cb174-7"><a href="data-manipulations.html#cb174-7"></a>cv10_sel<span class="sc">$</span>id2 <span class="ot">&lt;-</span> <span class="fu">rank</span>(cv10_sel<span class="sc">$</span>id)</span>
<span id="cb174-8"><a href="data-manipulations.html#cb174-8"></a></span>
<span id="cb174-9"><a href="data-manipulations.html#cb174-9"></a><span class="co">#simply place one dataset under the other thus row bind (rbind)</span></span>
<span id="cb174-10"><a href="data-manipulations.html#cb174-10"></a><span class="co">#check first if same vars in both datasets.</span></span>
<span id="cb174-11"><a href="data-manipulations.html#cb174-11"></a><span class="co">#perhaps clean up first. </span></span>
<span id="cb174-12"><a href="data-manipulations.html#cb174-12"></a></span>
<span id="cb174-13"><a href="data-manipulations.html#cb174-13"></a>cv08_sel <span class="ot">&lt;-</span> cv08_sel <span class="sc">%&gt;%</span></span>
<span id="cb174-14"><a href="data-manipulations.html#cb174-14"></a>    <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>,<span class="st">&quot;id2&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;men&quot;</span>, <span class="st">&quot;educ3&quot;</span>, <span class="st">&quot;health&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;wave&quot;</span>)) </span>
<span id="cb174-15"><a href="data-manipulations.html#cb174-15"></a></span>
<span id="cb174-16"><a href="data-manipulations.html#cb174-16"></a>cv10_sel <span class="ot">&lt;-</span> cv10_sel <span class="sc">%&gt;%</span></span>
<span id="cb174-17"><a href="data-manipulations.html#cb174-17"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>,<span class="st">&quot;id2&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;men&quot;</span>, <span class="st">&quot;educ3&quot;</span>, <span class="st">&quot;health&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;wave&quot;</span>))</span>
<span id="cb174-18"><a href="data-manipulations.html#cb174-18"></a></span>
<span id="cb174-19"><a href="data-manipulations.html#cb174-19"></a>cv_tot <span class="ot">&lt;-</span> cv08_sel <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(cv10_sel)</span></code></pre></div>
</div>
<div id="step4-check-1" class="section level4" number="8.4.2.4">
<h4><span class="header-section-number">8.4.2.4</span> Step4: check</h4>
<div class="sourceCode" id="cb175"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb175-1"><a href="data-manipulations.html#cb175-1"></a><span class="fu">summary</span>(cv_tot)</span></code></pre></div>
<pre><code>##        id                id2            age             men              educ3     
##  Min.   :20131231   Min.   :   1   Min.   :16.00   Min.   :0.000   primary  : 839  
##  1st Qu.:20132456   1st Qu.: 613   1st Qu.:33.00   1st Qu.:0.000   secondary:2777  
##  Median :20133680   Median :1225   Median :47.00   Median :1.000   tertiary :1275  
##  Mean   :27624666   Mean   :1274   Mean   :47.63   Mean   :0.513   NA&#39;s     :   8  
##  3rd Qu.:37978375   3rd Qu.:1838   3rd Qu.:62.00   3rd Qu.:1.000                   
##  Max.   :41199300   Max.   :2936   Max.   :96.00   Max.   :1.000                   
##                                    NA&#39;s   :4       NA&#39;s   :10                      
##      health           region           wave     
##  Min.   :-2.000   Min.   :1.000   Min.   :2008  
##  1st Qu.: 1.000   1st Qu.:2.000   1st Qu.:2008  
##  Median : 2.000   Median :3.000   Median :2010  
##  Mean   : 1.979   Mean   :2.799   Mean   :2009  
##  3rd Qu.: 2.000   3rd Qu.:3.000   3rd Qu.:2010  
##  Max.   : 5.000   Max.   :4.000   Max.   :2010  
## </code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb177-1"><a href="data-manipulations.html#cb177-1"></a><span class="fu">head</span>(cv_tot)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
## # Rowwise: 
##          id   id2       age       men educ3            health region  wave
##   &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl+lbl&gt; &lt;dbl+lbl&gt; &lt;fct&gt;         &lt;dbl+lbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1  36775330     1        51 1 [man]   tertiary  2 [goed,]          3  2008
## 2  36775340     2        39 0 [vrouw] tertiary  2 [goed,]          3  2008
## 3  36775420     3        16 0 [vrouw] secondary 2 [goed,]          3  2008
## 4  36775440     4        29 1 [man]   tertiary  2 [goed,]          3  2008
## 5  36775450     5        57 1 [man]   tertiary  3 [gaat wel,]      3  2008
## 6  36775460     6        49 0 [vrouw] secondary 2 [goed,]          3  2008</code></pre>
<p>Okay, lets pretend it was panel data <code>cv_tot</code> would then be a panel dataset in long format. But oftentimes, you want a panel dataset in wide format.<br />
If you don’t know the difference between long and wide format, check the differences between <code>cv_tot</code> and <code>cv_tot_panel</code> after step 3b.</p>
</div>
<div id="step3b-merge-1" class="section level4" number="8.4.2.5">
<h4><span class="header-section-number">8.4.2.5</span> Step3b: merge</h4>
<div class="sourceCode" id="cb179"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb179-1"><a href="data-manipulations.html#cb179-1"></a><span class="co">#lets make a panel dataset in wide format</span></span>
<span id="cb179-2"><a href="data-manipulations.html#cb179-2"></a>cv_tot_panel <span class="ot">&lt;-</span> <span class="fu">full_join</span>(cv08_sel, cv10_sel, <span class="at">by=</span><span class="st">&quot;id2&quot;</span>, <span class="at">suffix=</span><span class="fu">c</span>(<span class="st">&quot;.2008&quot;</span>, <span class="st">&quot;.2010&quot;</span>))</span></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-r-for-sna.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SNA-4-Social-Scientists.pdf", "SNA-4-Social-Scientists.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
